/*!
\file CentralBody.cpp
\author HanDle
中心天体
*/

#include "CentralBody.h"
#include "Utility.h"


//! 地球,包括时间、引力场模型(EGM96)和大气模型(SA76)
// ORBITDYN_API CEarth Earth;
Earth* Earth::theInstance = NULL;

//! 月球,包括引力场模型(默认为GLGM-2)
// ORBITDYN_API CMoon Moon;

CentralBody::CentralBody()
{
	memset(&(CLM[0][0]),0,sizeof(double)*10082);
	DataDir = GetOrbitDynDir();// 读取环境变量OrbitDyn，即data目录所在位置
#ifndef NONE_DATA_FILE_MODE
	EphModel = DE421EPH;
#else
	EphModel = ANALYTICEPH;
#endif //NONE_DATA_FILE_MODE
}

CentralBody::~CentralBody()
{

}

/*!
从引力场文件中读取引力场系数
*/
void CentralBody::ReadGrvFile(const char* file)
{
	FILE* grv;
	grv = fopen(file,"r");
	if(grv==NULL)
	{
		CentralBodyException ept;
		ept.SetDetails("Can't open file %s,please check the file in \\data directory and the file name!",file);
		throw ept;
	}
	fscanf_s(grv,"%lf%lf",&GrvParam,&Equator_Radius); // 读取前两个数，即引力常数和赤道半径
	int l,m;
	for(int III=1;III<2554;III++)
	{ // 读取引力场系数
		fscanf_s(grv,"%d%d",&l,&m);
		fscanf_s(grv,"%lf%lf",&CLM[l][m],&SLM[l][m]);
	}
	fclose(grv);
}
/*!
构造函数
*/
Earth::Earth()
{
	GrvModel = WGS84_EGM96;
	AtmosModel = MSISE2000;

#ifndef NONE_DATA_FILE_MODE
#if __APPLE__
    std::string Name = DataDir + "/data/WGS84_EGM96.grv";
#else
    std::string Name = DataDir + "\\data\\WGS84_EGM96.grv"; // 默认引力场文件为WGS84_EGM96.grv
#endif
	ReadGrvFile(Name.c_str());

#if __APPLE__
    Name = DataDir + "/data/EOP.dat";
#else
	Name = DataDir + "\\data\\EOP.dat";
#endif
	FILE* fp;
	fopen_s(&fp,Name.c_str(),"r");
	if(fp==NULL)
	{
		CentralBodyException ept;
		ept.SetDetails("Can't open EOP.dat file,pleast check the file in \\data directory!");
		throw ept;
	}
	fscanf_s(fp,"%d",&Num);
	fscanf_s(fp,"%lf",&mjd1);
	eop = new double*[Num];
	for(int I=0;I<Num;I++)
	{
		eop[I] = new double[4];
		for(int J=0;J<4;J++)
			fscanf_s(fp,"%lf",&eop[I][J]);
	}	
	fclose(fp);
#else
	GrvParam = 398600.4418;
	Equator_Radius = 6378.137;

	CLM[2][0]  = -4.841653717360e-04;
	CLM[3][0]  =  9.572541737920e-07;
	CLM[4][0]  =  5.398738637890e-07;
	CLM[5][0]  =  6.853234756300e-08;
	CLM[6][0]  = -1.499579947140e-07;
	CLM[7][0]  =  9.097893714500e-08;
	CLM[8][0]  =  4.967116673240e-08;
	CLM[9][0]  =  2.767143008530e-08;
	CLM[10][0] =  5.262224885690e-08;
	CLM[11][0] = -5.096137075220e-08;
	CLM[12][0] =  3.772526365580e-08;
	CLM[13][0] =  4.229822064130e-08;
	CLM[14][0] = -2.427865029210e-08;
	CLM[15][0] =  1.479100687080e-09;
	CLM[16][0] = -3.153229867220e-09;
	CLM[17][0] =  1.976050663950e-08;
	CLM[18][0] =  5.086910383320e-09;
	CLM[19][0] = -3.257809653940e-09;
	CLM[20][0] =  2.223846106510e-08;
	CLM[21][0] =  5.878202525750e-09;

	CLM[ 2][  1] =  -1.869876359550e-10;   SLM[ 2][  1] =   1.195280120310e-09;
	CLM[ 2][  2] =   2.439143523980e-06;   SLM[ 2][  2] =  -1.400166836540e-06;
	CLM[ 3][  1] =   2.029988821840e-06;   SLM[ 3][  1] =   2.485131587160e-07;
	CLM[ 3][  2] =   9.046277686050e-07;   SLM[ 3][  2] =  -6.190259442050e-07;
	CLM[ 3][  3] =   7.210726570570e-07;   SLM[ 3][  3] =   1.414356269580e-06;
	CLM[ 4][  1] =  -5.363216169710e-07;   SLM[ 4][  1] =  -4.734402658530e-07;
	CLM[ 4][  2] =   3.506941057850e-07;   SLM[ 4][  2] =   6.626715725400e-07;
	CLM[ 4][  3] =   9.907718038290e-07;   SLM[ 4][  3] =  -2.009283691770e-07;
	CLM[ 4][  4] =  -1.885608027350e-07;   SLM[ 4][  4] =   3.088531693330e-07;
	CLM[ 5][  1] =  -6.210121285280e-08;   SLM[ 5][  1] =  -9.442261275250e-08;
	CLM[ 5][  2] =   6.524382976120e-07;   SLM[ 5][  2] =  -3.233496126680e-07;
	CLM[ 5][  3] =  -4.519554060710e-07;   SLM[ 5][  3] =  -2.148471906240e-07;
	CLM[ 5][  4] =  -2.953016476540e-07;   SLM[ 5][  4] =   4.966588767690e-08;
	CLM[ 5][  5] =   1.749719832030e-07;   SLM[ 5][  5] =  -6.693842782190e-07;
	CLM[ 6][  1] =  -7.608793849470e-08;   SLM[ 6][  1] =   2.628905455010e-08;
	CLM[ 6][  2] =   4.817324428320e-08;   SLM[ 6][  2] =  -3.737282013470e-07;
	CLM[ 6][  3] =   5.717309905160e-08;   SLM[ 6][  3] =   9.026945171630e-09;
	CLM[ 6][  4] =  -8.621426601090e-08;   SLM[ 6][  4] =  -4.714081542670e-07;
	CLM[ 6][  5] =  -2.671333254900e-07;   SLM[ 6][  5] =  -5.364884324830e-07;
	CLM[ 6][  6] =   9.676161210920e-09;   SLM[ 6][  6] =  -2.371920069350e-07;
	CLM[ 7][  1] =   2.798729104880e-07;   SLM[ 7][  1] =   9.543369118670e-08;
	CLM[ 7][  2] =   3.297438164880e-07;   SLM[ 7][  2] =   9.306675960420e-08;
	CLM[ 7][  3] =   2.503986577060e-07;   SLM[ 7][  3] =  -2.171986087380e-07;
	CLM[ 7][  4] =  -2.751143552570e-07;   SLM[ 7][  4] =  -1.238003923230e-07;
	CLM[ 7][  5] =   1.937655072430e-09;   SLM[ 7][  5] =   1.773777198720e-08;
	CLM[ 7][  6] =  -3.588568606450e-07;   SLM[ 7][  6] =   1.517898177390e-07;
	CLM[ 7][  7] =   1.091851480450e-09;   SLM[ 7][  7] =   2.444157079930e-08;
	CLM[ 8][  1] =   2.334220478930e-08;   SLM[ 8][  1] =   5.900604934110e-08;
	CLM[ 8][  2] =   8.029787226150e-08;   SLM[ 8][  2] =   6.541754258590e-08;
	CLM[ 8][  3] =  -1.918777570090e-08;   SLM[ 8][  3] =  -8.634544450210e-08;
	CLM[ 8][  4] =  -2.446001054710e-07;   SLM[ 8][  4] =   7.002330169340e-08;
	CLM[ 8][  5] =  -2.553524030370e-08;   SLM[ 8][  5] =   8.914621647880e-08;
	CLM[ 8][  6] =  -6.573616109610e-08;   SLM[ 8][  6] =   3.092384618070e-07;
	CLM[ 8][  7] =   6.728115800720e-08;   SLM[ 8][  7] =   7.474404736330e-08;
	CLM[ 8][  8] =  -1.240924930160e-07;   SLM[ 8][  8] =   1.205331656030e-07;
	CLM[ 9][  1] =   1.433875027490e-07;   SLM[ 9][  1] =   2.168349476180e-08;
	CLM[ 9][  2] =   2.222883185640e-08;   SLM[ 9][  2] =  -3.221966471160e-08;
	CLM[ 9][  3] =  -1.608115021430e-07;   SLM[ 9][  3] =  -7.422874094620e-08;
	CLM[ 9][  4] =  -9.001792253360e-09;   SLM[ 9][  4] =   1.946667794750e-08;
	CLM[ 9][  5] =  -1.661650929240e-08;   SLM[ 9][  5] =  -5.411131914830e-08;
	CLM[ 9][  6] =   6.269419382480e-08;   SLM[ 9][  6] =   2.229035259450e-07;
	CLM[ 9][  7] =  -1.183663234750e-07;   SLM[ 9][  7] =  -9.651526678860e-08;
	CLM[ 9][  8] =   1.884360227940e-07;   SLM[ 9][  8] =  -3.085662204210e-09;
	CLM[ 9][  9] =  -4.774753861320e-08;   SLM[ 9][  9] =   9.664128477140e-08;
	CLM[10][  1] =   8.351157756520e-08;   SLM[10][  1] =  -1.313143317960e-07;
	CLM[10][  2] =  -9.424138820810e-08;   SLM[10][  2] =  -5.157916573900e-08;
	CLM[10][  3] =  -6.898950481760e-09;   SLM[10][  3] =  -1.537688286940e-07;
	CLM[10][  4] =  -8.407645497160e-08;   SLM[10][  4] =  -7.928062553310e-08;
	CLM[10][  5] =  -4.933959381850e-08;   SLM[10][  5] =  -5.053702218970e-08;
	CLM[10][  6] =  -3.758852365980e-08;   SLM[10][  6] =  -7.956670538720e-08;
	CLM[10][  7] =   8.114605409250e-09;   SLM[10][  7] =  -3.366296413140e-09;
	CLM[10][  8] =   4.049279816940e-08;   SLM[10][  8] =  -9.187059759220e-08;
	CLM[10][  9] =   1.254913349390e-07;   SLM[10][  9] =  -3.765162223920e-08;
	CLM[10][ 10] =   1.005386344090e-07;   SLM[10][ 10] =  -2.401484495200e-08;
	CLM[11][  1] =   1.516872099330e-08;   SLM[11][  1] =  -2.686041461660e-08;
	CLM[11][  2] =   1.863097498780e-08;   SLM[11][  2] =  -9.906938620470e-08;
	CLM[11][  3] =  -3.098712398540e-08;   SLM[11][  3] =  -1.481318042600e-07;
	CLM[11][  4] =  -3.895802050510e-08;   SLM[11][  4] =  -6.366665119800e-08;
	CLM[11][  5] =   3.778480294520e-08;   SLM[11][  5] =   4.947362381690e-08;
	CLM[11][  6] =  -1.186765923950e-09;   SLM[11][  6] =   3.447695845930e-08;
	CLM[11][  7] =   4.115651880740e-09;   SLM[11][  7] =  -8.982528089770e-08;
	CLM[11][  8] =  -5.984108413000e-09;   SLM[11][  8] =   2.439896122370e-08;
	CLM[11][  9] =  -3.142310727230e-08;   SLM[11][  9] =   4.177318298290e-08;
	CLM[11][ 10] =  -5.218826819270e-08;   SLM[11][ 10] =  -1.833645617880e-08;
	CLM[11][ 11] =   4.603444487460e-08;   SLM[11][ 11] =  -6.966623081850e-08;
	CLM[12][  1] =  -5.406549778360e-08;   SLM[12][  1] =  -4.356757489790e-08;
	CLM[12][  2] =   1.429796422530e-08;   SLM[12][  2] =   3.209759376190e-08;
	CLM[12][  3] =   3.939958764030e-08;   SLM[12][  3] =   2.442648635050e-08;
	CLM[12][  4] =  -6.869081279340e-08;   SLM[12][  4] =   4.150811090110e-09;
	CLM[12][  5] =   3.094111287300e-08;   SLM[12][  5] =   7.825362790330e-09;
	CLM[12][  6] =   3.415232752080e-09;   SLM[12][  6] =   3.917654844490e-08;
	CLM[12][  7] =  -1.869099585870e-08;   SLM[12][  7] =   3.561318493820e-08;
	CLM[12][  8] =  -2.537693988650e-08;   SLM[12][  8] =   1.693610246290e-08;
	CLM[12][  9] =   4.228806306620e-08;   SLM[12][  9] =   2.526925983010e-08;
	CLM[12][ 10] =  -6.176196549020e-09;   SLM[12][ 10] =   3.083757942120e-08;
	CLM[12][ 11] =   1.125029941220e-08;   SLM[12][ 11] =  -6.379465015580e-09;
	CLM[12][ 12] =  -2.495326073900e-09;   SLM[12][ 12] =  -1.117806019000e-08;
	CLM[13][  1] =  -5.135696991240e-08;   SLM[13][  1] =   3.905103866850e-08;
	CLM[13][  2] =   5.592176670990e-08;   SLM[13][  2] =  -6.273375653810e-08;
	CLM[13][  3] =  -2.193609279450e-08;   SLM[13][  3] =   9.748293622370e-08;
	CLM[13][  4] =  -3.137625996660e-09;   SLM[13][  4] =  -1.196278744920e-08;
	CLM[13][  5] =   5.900493949050e-08;   SLM[13][  5] =   6.649759580360e-08;
	CLM[13][  6] =  -3.590380730750e-08;   SLM[13][  6] =  -6.572806136860e-09;
	CLM[13][  7] =   2.530021470870e-09;   SLM[13][  7] =  -6.214708223310e-09;
	CLM[13][  8] =  -9.831508226950e-09;   SLM[13][  8] =  -1.047402228250e-08;
	CLM[13][  9] =   2.473257717910e-08;   SLM[13][  9] =   4.528703699360e-08;
	CLM[13][ 10] =   4.103246539300e-08;   SLM[13][ 10] =  -3.681210294800e-08;
	CLM[13][ 11] =  -4.438696773990e-08;   SLM[13][ 11] =  -4.765078042880e-09;
	CLM[13][ 12] =  -3.126222002220e-08;   SLM[13][ 12] =   8.784058092670e-08;
	CLM[13][ 13] =  -6.127595531990e-08;   SLM[13][ 13] =   6.852614885940e-08;
	CLM[14][  1] =  -1.869686163810e-08;   SLM[14][  1] =   2.947475422490e-08;
	CLM[14][  2] =  -3.677893795020e-08;   SLM[14][  2] =  -5.167793920550e-09;
	CLM[14][  3] =   3.588750973330e-08;   SLM[14][  3] =   2.046188278330e-08;
	CLM[14][  4] =   1.838656177920e-09;   SLM[14][  4] =  -2.267806135660e-08;
	CLM[14][  5] =   2.873442735420e-08;   SLM[14][  5] =  -1.638822497280e-08;
	CLM[14][  6] =  -1.948104855740e-08;   SLM[14][  6] =   2.478312727810e-09;
	CLM[14][  7] =   3.750038394150e-08;   SLM[14][  7] =  -4.172913194290e-09;
	CLM[14][  8] =  -3.509464858650e-08;   SLM[14][  8] =  -1.535152652030e-08;
	CLM[14][  9] =   3.202849393410e-08;   SLM[14][  9] =   2.888049220640e-08;
	CLM[14][ 10] =   3.903291800080e-08;   SLM[14][ 10] =  -1.443084524690e-09;
	CLM[14][ 11] =   1.539705165020e-08;   SLM[14][ 11] =  -3.905481732450e-08;
	CLM[14][ 12] =   8.408291638690e-09;   SLM[14][ 12] =  -3.113271891170e-08;
	CLM[14][ 13] =   3.221470439640e-08;   SLM[14][ 13] =   4.518972249600e-08;
	CLM[14][ 14] =  -5.189807943090e-08;   SLM[14][ 14] =  -4.815066367480e-09;
	CLM[15][  1] =   1.008172681770e-08;   SLM[15][  1] =   1.097730663240e-08;
	CLM[15][  2] =  -2.139426737750e-08;   SLM[15][  2] =  -3.089148757770e-08;
	CLM[15][  3] =   5.213929290410e-08;   SLM[15][  3] =   1.728929261030e-08;
	CLM[15][  4] =  -4.081500840780e-08;   SLM[15][  4] =   6.501747077940e-09;
	CLM[15][  5] =   1.249357231080e-08;   SLM[15][  5] =   8.083755639960e-09;
	CLM[15][  6] =   3.312116438960e-08;   SLM[15][  6] =  -3.682460043040e-08;
	CLM[15][  7] =   5.962106992590e-08;   SLM[15][  7] =   5.318411718790e-09;
	CLM[15][  8] =  -3.224286914980e-08;   SLM[15][  8] =   2.215235795870e-08;
	CLM[15][  9] =   1.287882680850e-08;   SLM[15][  9] =   3.756298208290e-08;
	CLM[15][ 10] =   1.046887225210e-08;   SLM[15][ 10] =   1.472221470150e-08;
	CLM[15][ 11] =  -1.116750619340e-09;   SLM[15][ 11] =   1.809961984320e-08;
	CLM[15][ 12] =  -3.239621344150e-08;   SLM[15][ 12] =   1.552431047460e-08;
	CLM[15][ 13] =  -2.839330191170e-08;   SLM[15][ 13] =  -4.220667911030e-09;
	CLM[15][ 14] =   5.191688593300e-09;   SLM[15][ 14] =  -2.437527396660e-08;
	CLM[15][ 15] =  -1.909305383220e-08;   SLM[15][ 15] =  -4.711394215580e-09;
	CLM[16][  1] =   2.583608562310e-08;   SLM[16][  1] =   3.254475608590e-08;
	CLM[16][  2] =  -2.336714045120e-08;   SLM[16][  2] =   2.887993634390e-08;
	CLM[16][  3] =  -3.360194293910e-08;   SLM[16][  3] =  -2.204189880100e-08;
	CLM[16][  4] =   4.023162843140e-08;   SLM[16][  4] =   4.838377169090e-08;
	CLM[16][  5] =  -1.295019392450e-08;   SLM[16][  5] =  -3.194585781290e-09;
	CLM[16][  6] =   1.402392523230e-08;   SLM[16][  6] =  -3.507602083030e-08;
	CLM[16][  7] =  -7.084126351360e-09;   SLM[16][  7] =  -8.815815611310e-09;
	CLM[16][  8] =  -2.090188680940e-08;   SLM[16][  8] =   5.005273905300e-09;
	CLM[16][  9] =  -2.185887206430e-08;   SLM[16][  9] =  -3.950124199940e-08;
	CLM[16][ 10] =  -1.175299008140e-08;   SLM[16][ 10] =   1.142115829610e-08;
	CLM[16][ 11] =   1.875740425920e-08;   SLM[16][ 11] =  -3.031619199250e-09;
	CLM[16][ 12] =   1.954001940380e-08;   SLM[16][ 12] =   6.669835740710e-09;
	CLM[16][ 13] =   1.381963695760e-08;   SLM[16][ 13] =   1.027784995080e-09;
	CLM[16][ 14] =  -1.931821688560e-08;   SLM[16][ 14] =  -3.861748937760e-08;
	CLM[16][ 15] =  -1.451490601420e-08;   SLM[16][ 15] =  -3.274430787390e-08;
	CLM[16][ 16] =  -3.796717107460e-08;   SLM[16][ 16] =   3.021553726550e-09;
	CLM[17][  1] =  -2.541775751180e-08;   SLM[17][  1] =  -3.066305296890e-08;
	CLM[17][  2] =  -1.959886567210e-08;   SLM[17][  2] =   6.492658934100e-09;
	CLM[17][  3] =   5.641230662240e-09;   SLM[17][  3] =   6.783270955290e-09;
	CLM[17][  4] =   7.074570756370e-09;   SLM[17][  4] =   2.494376008340e-08;
	CLM[17][  5] =  -1.549870060520e-08;   SLM[17][  5] =   6.600215518510e-09;
	CLM[17][  6] =  -1.181940128470e-08;   SLM[17][  6] =  -2.897709751770e-08;
	CLM[17][  7] =   2.421497023810e-08;   SLM[17][  7] =  -4.222229736970e-09;
	CLM[17][  8] =   3.884420975590e-08;   SLM[17][  8] =   3.589040959430e-09;
	CLM[17][  9] =   3.813564932310e-09;   SLM[17][  9] =  -2.814669437140e-08;
	CLM[17][ 10] =  -3.882160855420e-09;   SLM[17][ 10] =   1.813281765080e-08;
	CLM[17][ 11] =  -1.573566003630e-08;   SLM[17][ 11] =   1.065606494040e-08;
	CLM[17][ 12] =   2.880130106550e-08;   SLM[17][ 12] =   2.034501360840e-08;
	CLM[17][ 13] =   1.655034257310e-08;   SLM[17][ 13] =   2.046675314350e-08;
	CLM[17][ 14] =  -1.419838726490e-08;   SLM[17][ 14] =   1.149480252440e-08;
	CLM[17][ 15] =   5.421003616570e-09;   SLM[17][ 15] =   5.326103698110e-09;
	CLM[17][ 16] =  -3.019922050430e-08;   SLM[17][ 16] =   3.653319185310e-09;
	CLM[17][ 17] =  -3.430868560410e-08;   SLM[17][ 17] =  -1.985234553810e-08;
	CLM[18][  1] =   7.210984496490e-09;   SLM[18][  1] =  -3.887144730130e-08;
	CLM[18][  2] =   1.406317712050e-08;   SLM[18][  2] =   1.000933962530e-08;
	CLM[18][  3] =  -5.072325208730e-09;   SLM[18][  3] =  -4.908659313350e-09;
	CLM[18][  4] =   5.487593082170e-08;   SLM[18][  4] =  -1.352671177200e-09;
	CLM[18][  5] =   5.487104855550e-09;   SLM[18][  5] =   2.643386294590e-08;
	CLM[18][  6] =   1.465707552710e-08;   SLM[18][  6] =  -1.364380199510e-08;
	CLM[18][  7] =   6.758123284170e-09;   SLM[18][  7] =   6.885774942350e-09;
	CLM[18][  8] =   3.076198451440e-08;   SLM[18][  8] =   4.178277341070e-09;
	CLM[18][  9] =  -1.884706018800e-08;   SLM[18][  9] =   3.683027369530e-08;
	CLM[18][ 10] =   5.275353589340e-09;   SLM[18][ 10] =  -4.660915358810e-09;
	CLM[18][ 11] =  -7.296285189600e-09;   SLM[18][ 11] =   1.952152080200e-09;
	CLM[18][ 12] =  -2.974494124220e-08;   SLM[18][ 12] =  -1.644978783950e-08;
	CLM[18][ 13] =  -6.279197171520e-09;   SLM[18][ 13] =  -3.483839399380e-08;
	CLM[18][ 14] =  -8.156053364100e-09;   SLM[18][ 14] =  -1.286365850270e-08;
	CLM[18][ 15] =  -4.050034128790e-08;   SLM[18][ 15] =  -2.026849980210e-08;
	CLM[18][ 16] =   1.041410420280e-08;   SLM[18][ 16] =   6.614688176240e-09;
	CLM[18][ 17] =   3.587715868410e-09;   SLM[18][ 17] =   4.480655875640e-09;
	CLM[18][ 18] =   3.123519537170e-09;   SLM[18][ 18] =  -1.099060325430e-08;
	CLM[19][  1] =  -7.599038853190e-09;   SLM[19][  1] =   1.268354726050e-09;
	CLM[19][  2] =   3.535415286550e-08;   SLM[19][  2] =  -1.313463035140e-09;
	CLM[19][  3] =  -9.741036073090e-09;   SLM[19][  3] =   1.506622590430e-09;
	CLM[19][  4] =   1.570390090570e-08;   SLM[19][  4] =  -7.616773838110e-09;
	CLM[19][  5] =   1.096292133790e-08;   SLM[19][  5] =   2.831721764380e-08;
	CLM[19][  6] =  -4.087451786580e-09;   SLM[19][  6] =   1.862194307190e-08;
	CLM[19][  7] =   4.782753370440e-09;   SLM[19][  7] =  -7.172834559000e-09;
	CLM[19][  8] =   2.949083642800e-08;   SLM[19][  8] =  -9.930370028830e-09;
	CLM[19][  9] =   3.079614271590e-09;   SLM[19][  9] =   6.941104772140e-09;
	CLM[19][ 10] =  -3.384150690430e-08;   SLM[19][ 10] =  -7.379817671360e-09;
	CLM[19][ 11] =   1.604436529160e-08;   SLM[19][ 11] =   9.966734534830e-09;
	CLM[19][ 12] =  -2.471065815810e-09;   SLM[19][ 12] =   9.168523106420e-09;
	CLM[19][ 13] =  -7.447173799800e-09;   SLM[19][ 13] =  -2.825844667420e-08;
	CLM[19][ 14] =  -4.705025892150e-09;   SLM[19][ 14] =  -1.295266979830e-08;
	CLM[19][ 15] =  -1.765805497710e-08;   SLM[19][ 15] =  -1.403509900390e-08;
	CLM[19][ 16] =  -2.169500961880e-08;   SLM[19][ 16] =  -7.245347215670e-09;
	CLM[19][ 17] =   2.904449360790e-08;   SLM[19][ 17] =  -1.534565310700e-08;
	CLM[19][ 18] =   3.483821995930e-08;   SLM[19][ 18] =  -9.541463449170e-09;
	CLM[19][ 19] =  -2.573493494300e-09;   SLM[19][ 19] =   4.831518223630e-09;
	CLM[20][  1] =   5.163031252180e-09;   SLM[20][  1] =   6.696267269660e-09;
	CLM[20][  2] =   1.988311282380e-08;   SLM[20][  2] =   1.751838432570e-08;
	CLM[20][  3] =  -3.626014367850e-09;   SLM[20][  3] =   3.795907241410e-08;
	CLM[20][  4] =   2.422381186520e-09;   SLM[20][  4] =  -2.110576118740e-08;
	CLM[20][  5] =  -1.070425625640e-08;   SLM[20][  5] =  -7.718600831690e-09;
	CLM[20][  6] =   1.104748375700e-08;   SLM[20][  6] =  -2.177203658980e-09;
	CLM[20][  7] =  -2.100902827280e-08;   SLM[20][  7] =  -2.234915039690e-11;
	CLM[20][  8] =   4.424191856370e-09;   SLM[20][  8] =   1.830358045930e-09;
	CLM[20][  9] =   1.788462169420e-08;   SLM[20][  9] =  -6.639408653580e-09;
	CLM[20][ 10] =  -3.253949199880e-08;   SLM[20][ 10] =  -5.123088736210e-09;
	CLM[20][ 11] =   1.389927076970e-08;   SLM[20][ 11] =  -1.877064549420e-08;
	CLM[20][ 12] =  -6.357506007500e-09;   SLM[20][ 12] =   1.802608531030e-08;
	CLM[20][ 13] =   2.752227259970e-08;   SLM[20][ 13] =   6.908870775880e-09;
	CLM[20][ 14] =   1.158411694050e-08;   SLM[20][ 14] =  -1.431761601430e-08;
	CLM[20][ 15] =  -2.601307442910e-08;   SLM[20][ 15] =  -7.843796724130e-10;
	CLM[20][ 16] =  -1.241371471180e-08;   SLM[20][ 16] =  -2.775004436280e-10;
	CLM[20][ 17] =   4.369096679600e-09;   SLM[20][ 17] =  -1.374204461980e-08;
	CLM[20][ 18] =   1.518428830220e-08;   SLM[20][ 18] =  -8.084299031420e-10;
	CLM[20][ 19] =  -3.149420028520e-09;   SLM[20][ 19] =   1.065052022450e-08;
	CLM[20][ 20] =   4.014483279680e-09;   SLM[20][ 20] =  -1.204506447850e-08;
	CLM[21][  1] =  -1.610006701410e-08;   SLM[21][  1] =   2.843594007910e-08;
	CLM[21][  2] =  -6.544604825580e-09;   SLM[21][  2] =   3.784748685080e-09;
	CLM[21][  3] =   1.954919952600e-08;   SLM[21][  3] =   2.262869637160e-08;
	CLM[21][  4] =  -5.766043392390e-09;   SLM[21][  4] =   1.944937826310e-08;
	CLM[21][  5] =   2.588563030160e-09;   SLM[21][  5] =   1.708503686690e-09;
	CLM[21][  6] =  -1.401688105890e-08;   SLM[21][  6] =  -2.738148263810e-12;
	CLM[21][  7] =  -8.643571684750e-09;   SLM[21][  7] =   4.426122771190e-09;
	CLM[21][  8] =  -1.704772782370e-08;   SLM[21][  8] =   1.507111926300e-09;
	CLM[21][  9] =   1.644890623940e-08;   SLM[21][  9] =   8.301131963650e-09;
	CLM[21][ 10] =  -1.099289764090e-08;   SLM[21][ 10] =  -1.469137946840e-09;
	CLM[21][ 11] =   6.993003642140e-09;   SLM[21][ 11] =  -3.535905651240e-08;
	CLM[21][ 12] =  -3.193001095940e-09;   SLM[21][ 12] =   1.457869179470e-08;
	CLM[21][ 13] =  -1.898545245900e-08;   SLM[21][ 13] =   1.405147914360e-08;
	CLM[21][ 14] =   2.035807856740e-08;   SLM[21][ 14] =   7.557724628400e-09;
	CLM[21][ 15] =   1.755302202780e-08;   SLM[21][ 15] =   1.045338868320e-08;
	CLM[21][ 16] =   7.869691093670e-09;   SLM[21][ 16] =  -6.560897152790e-09;
	CLM[21][ 17] =  -6.994844899810e-09;   SLM[21][ 17] =  -7.360649011470e-09;
	CLM[21][ 18] =   2.596432915210e-08;   SLM[21][ 18] =  -1.115608061300e-08;
	CLM[21][ 19] =  -2.737416364100e-08;   SLM[21][ 19] =   1.639581900520e-08;
	CLM[21][ 20] =  -2.686824735840e-08;   SLM[21][ 20] =   1.620860571680e-08;
	CLM[21][ 21] =   8.303748739320e-09;   SLM[21][ 21] =  -3.755461217420e-09;
#endif //NONE_DATA_FILE_MODE

	J2 = -CLM[2][0]*sqrt(5.0);
	A2 =  1.5*J2;
	J3 = -CLM[3][0]*sqrt(7.0);
	A3 = -J3;
	J4 = -CLM[4][0]*3.0;
	A4 = -4.375*J4;
}

Earth::~Earth()
{
#ifndef NONE_DATA_FILE_MODE
    for(int I=0;I<Num;I++)
		delete[] eop[I];
	delete[] eop;
#else

#endif //NONE_DATA_FILE_MODE
}

Earth* Earth::Instance()
{
	if(theInstance==NULL)
		theInstance = new Earth;

	return theInstance;
}
/*!
设置引力场模型，从文件中读入引力场系数
*/
void Earth::SetGravityField(GRAVITY grv)
{
	if(grv == GrvModel) return;
	GrvModel = grv;
	std::string Name;
	switch(grv)
	{
#if __APPLE__
    case WGS84:
        Name = DataDir + "/data/WGS84.grv";
        break;
    case WGS84_EGM96:
        Name = DataDir + "/data/WGS84_EGM96.grv";
        break;
    case EGM96:
        Name = DataDir + "/data/EGM96.grv";
        break;
    case JGM2:
        Name = DataDir + "/data/JGM2.grv";
        break;
    case JGM3:
        Name = DataDir + "/data/JGM3.grv";
        break;
#else
	case WGS84:
		Name = DataDir + "\\data\\WGS84.grv";
		break;
	case WGS84_EGM96:
		Name = DataDir + "\\data\\WGS84_EGM96.grv";
		break;
	case EGM96:
		Name = DataDir + "\\data\\EGM96.grv";
		break;
	case JGM2:
		Name = DataDir + "\\data\\JGM2.grv";
		break;
	case JGM3:
		Name = DataDir + "\\data\\JGM3.grv";
		break;
#endif
	default:
		throw CentralBodyException("CEarth::SetEarthGravityField(): Can't find that Gravity model!");
	}
	ReadGrvFile(Name.c_str());

	J2 = -CLM[2][0]*sqrt(5.0);
	A2 =  1.5*J2;
	J3 = -CLM[3][0]*sqrt(7.0);
	A3 = -J3;
	J4 = -CLM[4][0]*3.0;
	A4 = -4.375*J4;	
}

/*! 设置大气模型

*/
void Earth::SetAtmosphereModel( ATMOS a)
{
	if(AtmosModel == a) return;
	AtmosModel = a;
	if(AtmosModel == MANUAL)
	{
#if __APPLE__
        std::string Name = DataDir + "/data/atmos.den";
#else
		std::string Name = DataDir + "\\data\\atmos.den";
#endif
		FILE* fp;
		fopen_s(&fp,Name.c_str(),"r");
		if(fp==NULL)
			throw CentralBodyException("CEarth::SetAtmosphereModel() : Can't open atmos.den file,pleast check the file in \\data directory!");
		fscanf_s(fp,"%d",&file_atmos_den.nrow);
		fscanf_s(fp,"%lf",&file_atmos_den.step);
		file_atmos_den.t = new double[file_atmos_den.nrow];
		file_atmos_den.rou = new double[file_atmos_den.nrow];
		for(int I=0;I<file_atmos_den.nrow;I++)
		{
			fscanf_s(fp,"%lf",&(file_atmos_den.t[I]));
			fscanf_s(fp,"%lf",&(file_atmos_den.rou[I]));
		}	
		fclose(fp);
	}
}

//! 获得地心J2000惯性系下的位置
vec3 Earth::GetECI(const CDateTime& t)
{
	return vec3("0 0 0");;
}

/*!
由eop进行分段二次多项式插值得到极移
\param  Xp ( X,Y ) component of pole wander
\param  Yp ( X,Y ) component of pole wander
*/
void Earth::GetPolarMotion(const CDateTime& t,double& Xp,double& Yp)
{
#ifndef NONE_DATA_FILE_MODE
	double utc = t.GetUTC();
	if( utc<eop[0][0] || utc>eop[Num-1][0])
	{
		Xp = 0;   Yp = 0;
	}
	else
	{
		int a,b,c; // 插值时使用的结点编号
		if(utc<=eop[0][0]+0.5) { a=0; b=1; c=2; }
		else if(utc>=eop[Num-1][0]-0.5) { a=Num-3; b=Num-2; c=Num-1; }
		else {	b=(int)floor(utc-mjd1); a=b-1; c=b+1; }
		double L1 = (utc-eop[b][0])*(utc-eop[c][0])/(eop[a][0]-eop[b][0])/(eop[a][0]-eop[c][0]);
		double L2 = (utc-eop[a][0])*(utc-eop[c][0])/(eop[b][0]-eop[a][0])/(eop[b][0]-eop[c][0]);
		double L3 = (utc-eop[a][0])*(utc-eop[b][0])/(eop[c][0]-eop[a][0])/(eop[c][0]-eop[b][0]);
        Xp = L1*eop[a][1] + L2*eop[b][1] + L3*eop[c][1];
		Yp = L1*eop[a][2] + L2*eop[b][2] + L3*eop[c][2];
		Xp = Xp / 3600 * RAD;
		Yp = Yp / 3600 * RAD;
	}
#else
	Xp = 0;
	Yp = 0;
#endif //NONE_DATA_FILE_MODE
}
double Earth::GetdUT1(const CDateTime& t)
{
#ifndef NONE_DATA_FILE_MODE
	double utc = t.GetUTC();
	if( utc<eop[0][0] || utc>eop[Num-1][0])
	{
		return 0;
	}
	else
	{
		int a,b,c; // 插值时使用的结点编号
		if(utc<=eop[0][0]+0.5) { a=0; b=1; c=2; }
		else if(utc>=eop[Num-1][0]-0.5) { a=Num-3; b=Num-2; c=Num-1; }
		else {	b = (int)floor(utc-mjd1); a=b-1; c=b+1; }
		double L1 = (utc-eop[b][0])*(utc-eop[c][0])/(eop[a][0]-eop[b][0])/(eop[a][0]-eop[c][0]);
		double L2 = (utc-eop[a][0])*(utc-eop[c][0])/(eop[b][0]-eop[a][0])/(eop[b][0]-eop[c][0]);
		double L3 = (utc-eop[a][0])*(utc-eop[b][0])/(eop[c][0]-eop[a][0])/(eop[c][0]-eop[b][0]);
		return L1*eop[a][3] + L2*eop[b][3] + L3*eop[c][3];
	}
#else
	return 0;
#endif //NONE_DATA_FILE_MODE
}
/*!
计算大气密度，目前使用的是SA76大气模型
输入h为卫星高度，单位km
返回值为大气密度atmospheric density，单位kg/m^3
*/
double Earth::AtmosRuoH(const CDateTime& t,const vec3& ECFr)
{
	if(AtmosModel == STANDARD1976)
	{
		// lkh修改，使用大地地理高度代替r-Re，使大气阻力计算精度提高
		CSpherical lla = ECF_LLA(ECFr);
		double h = lla.Altitude;
		if( h>1000 ) return 0;
		if( h<0 ) throw CentralBodyException("CEarth::AtmosRouH : Heigth is less than 0");
		return SA76(h); //SA76大气模型
	}
	else if(AtmosModel == MSISE2000)
	{
		return Msise.Density(t,ECFr);
	}
	else if(AtmosModel == MANUAL)
	{
		double utc = t.GetUTC();
		if( utc<file_atmos_den.t[0] || utc>file_atmos_den.t[file_atmos_den.nrow-1])
		{
			return 0;
		}
		else
		{
			int a,b,c; // 插值时使用的结点编号
			if( utc <= file_atmos_den.t[1] ) 
			{ 
				a=0;
				b=1;
				c=2;
			}
			else if( utc >= file_atmos_den.t[file_atmos_den.nrow-2] )
			{
				a = file_atmos_den.nrow - 3;
				b = file_atmos_den.nrow - 2;
				c = file_atmos_den.nrow - 1;
			}
			else 
			{	
				b = (int)floor((utc-file_atmos_den.t[0])/(file_atmos_den.step/86400));
				a = b - 1;
				c = b + 1;
			}
			double L1 = (utc-file_atmos_den.t[b])*(utc-file_atmos_den.t[c])/(file_atmos_den.t[a]-file_atmos_den.t[b])/(file_atmos_den.t[a]-file_atmos_den.t[c]);
			double L2 = (utc-file_atmos_den.t[a])*(utc-file_atmos_den.t[c])/(file_atmos_den.t[b]-file_atmos_den.t[a])/(file_atmos_den.t[b]-file_atmos_den.t[c]);
			double L3 = (utc-file_atmos_den.t[a])*(utc-file_atmos_den.t[b])/(file_atmos_den.t[c]-file_atmos_den.t[a])/(file_atmos_den.t[c]-file_atmos_den.t[b]);
			double rou = L1*file_atmos_den.rou[a] + L2*file_atmos_den.rou[b] + L3*file_atmos_den.rou[c];
			//double rou2 = Msise.Density(t,ECFr);
			return rou*1e-9; // 文件中ρ为kg/km^3,这里转化为kg/m^3
		}
	}
	else
		throw CentralBodyException("CEarth::AtmosRuoH() : unkown atmosphere model");
}

Moon* Moon::theInstance = NULL;

Moon* Moon::Instance()
{
	if(theInstance==NULL)
		theInstance = new Moon;
	return theInstance;
}

Moon::Moon()
{
#if __APPLE__
    std::string name = DataDir + "/data/LP165P.grv";
#else
	std::string name = DataDir + "\\data\\LP165P.grv";   // 默认引力场文件为GLGM2.grv
#endif
	GrvModel = LP165P;
#ifndef NONE_DATA_FILE_MODE
	ReadGrvFile(name.c_str());
#else
	GrvParam = 4902.801056;
	Equator_Radius = 1738.0;
	CLM[2 ][0 ] = 	-9.0890180750600000E-05;		SLM[2 ][0 ] = 0.0000000000000000E+00;
	CLM[2 ][1 ] = 	-2.7220323615900000E-09;        SLM[2 ][1 ] = -7.5751829208300000E-1;
	CLM[2 ][2 ] = 	3.4635499372200000E-05	;       SLM[2 ][2 ] = 1.6729490538300000E-08;
	CLM[3 ][0 ] = 	-3.2035914003000000E-06;        SLM[3 ][0 ] = 0.0000000000000000E+00;
	CLM[3 ][1 ] = 	2.6327440121800000E-05	;       SLM[3 ][1 ] = 5.4643630898200000E-06;
	CLM[3 ][2 ] = 	1.4188179329400000E-05	;       SLM[3 ][2 ] = 4.8920365004800000E-06;
	CLM[3 ][3 ] = 	1.2286058944700000E-05	;       SLM[3 ][3 ] = -1.7854480816400000E-0;
	CLM[4 ][0 ] = 	3.1973095717200000E-06	;       SLM[4 ][0 ] = 0.0000000000000000E+00;
	CLM[4 ][1 ] = 	-5.9966018301500000E-06;        SLM[4 ][1 ] = 1.6619345194700000E-06;
	CLM[4 ][2 ] = 	-7.0818069269700000E-06;        SLM[4 ][2 ] = -6.7836271726900000E-0;
	CLM[4 ][3 ] = 	-1.3622983381300000E-06;        SLM[4 ][3 ] = -1.3443472287100000E-0;
	CLM[4 ][4 ] = 	-6.0257787358300000E-06;        SLM[4 ][4 ] = 3.9396371953800000E-06;
	CLM[5 ][0 ] = 	-2.1570382068200000E-07;        SLM[5 ][0 ] = 0.0000000000000000E+00;
	CLM[5 ][1 ] = 	-1.0191956537600000E-06;        SLM[5 ][1 ] = -4.1092541507300000E-0;
	CLM[5 ][2 ] = 	4.3766081149700000E-06	;       SLM[5 ][2 ] = 1.0840997698800000E-06;
	CLM[5 ][3 ] = 	4.4977678759500000E-07	;       SLM[5 ][3 ] = 8.7008412086200000E-06;
	CLM[5 ][4 ] = 	2.7834241360300000E-06	;       SLM[5 ][4 ] = 5.9388023933000000E-08;
	CLM[5 ][5 ] = 	3.1196258937700000E-06	;       SLM[5 ][5 ] = -2.7609662719600000E-0;
	CLM[6 ][0 ] = 	3.7657806186600000E-06	;       SLM[6 ][0 ] = 0.0000000000000000E+00;
	CLM[6 ][1 ] = 	1.5319843938900000E-06	;       SLM[6 ][1 ] = -2.5766006397600000E-0;
	CLM[6 ][2 ] = 	-4.3522181232300000E-06;        SLM[6 ][2 ] = -2.1874480152200000E-0;
	CLM[6 ][3 ] = 	-3.2700516346000000E-06;        SLM[6 ][3 ] = -3.4691430284300000E-0;
	CLM[6 ][4 ] = 	3.6978218578600000E-07	;       SLM[6 ][4 ] = -4.0688106563000000E-0;
	CLM[6 ][5 ] = 	1.4044746183500000E-06	;       SLM[6 ][5 ] = -1.0331701889700000E-0;
	CLM[6 ][6 ] = 	-4.7043010854600000E-06;        SLM[6 ][6 ] = 7.2360088135100000E-06;
	CLM[7 ][0 ] = 	5.6222117872800000E-06	;       SLM[7 ][0 ] = 0.0000000000000000E+00;
	CLM[7 ][1 ] = 	7.5522592344500000E-06	;       SLM[7 ][1 ] = -1.2965222023300000E-0;
	CLM[7 ][2 ] = 	-6.6319483616000000E-07;        SLM[7 ][2 ] = 2.3847890671600000E-06;
	CLM[7 ][3 ] = 	5.8267879947700000E-07	;       SLM[7 ][3 ] = 2.3557722607000000E-06;
	CLM[7 ][4 ] = 	-9.2662653013000000E-07;        SLM[7 ][4 ] = 7.9157365466100000E-07;
	CLM[7 ][5 ] = 	-2.7194779737000000E-07;        SLM[7 ][5 ] = 1.1268778788400000E-06;
	CLM[7 ][6 ] = 	-9.9288572413399900E-07;        SLM[7 ][6 ] = 1.1079548668400000E-06;
	CLM[7 ][7 ] = 	-1.7884660886500000E-06;        SLM[7 ][7 ] = -1.6165071071600000E-0;
	CLM[8 ][0 ] = 	2.3464996801200000E-06	;       SLM[8 ][0 ] = 0.0000000000000000E+00;
	CLM[8 ][1 ] = 	-6.0889812179200000E-08;        SLM[8 ][1 ] = 1.1125448614800000E-06;
	CLM[8 ][2 ] = 	2.9947778779900000E-06	;       SLM[8 ][2 ] = 1.9258324758400000E-06;
	CLM[8 ][3 ] = 	-1.8800121811500000E-06;        SLM[8 ][3 ] = 9.5358255051000000E-07;
	CLM[8 ][4 ] = 	3.3735197215900000E-06	;       SLM[8 ][4 ] = -4.5605653956900000E-0;
	CLM[8 ][5 ] = 	-1.1252727173200000E-06;        SLM[8 ][5 ] = 2.9257149531900000E-06;
	CLM[8 ][6 ] = 	-1.5433014412800000E-06;        SLM[8 ][6 ] = -2.2481842711100000E-0;
	CLM[8 ][7 ] = 	-1.5914651800100000E-06;        SLM[8 ][7 ] = 3.2220909725500000E-06;
	CLM[8 ][8 ] = 	-2.5306972591200000E-06;        SLM[8 ][8 ] = 2.1406200235600000E-06;
	CLM[9 ][0 ] = 	-3.5550338295600000E-06;        SLM[9 ][0 ] = 0.0000000000000000E+00;
	CLM[9 ][1 ] = 	1.9804256734600000E-06	;       SLM[9 ][1 ] = 7.8963720308300000E-08;
	CLM[9 ][2 ] = 	1.9910283248200000E-06	;       SLM[9 ][2 ] = -1.4492211441300000E-0;
	CLM[9 ][3 ] = 	-2.0186212398900000E-06;        SLM[9 ][3 ] = 2.2340573503600000E-06;
	CLM[9 ][4 ] = 	-1.8959343588300000E-06;        SLM[9 ][4 ] = -1.3850645020500000E-0;
	CLM[9 ][5 ] = 	-1.4845690537500000E-06;        SLM[9 ][5 ] = -3.6993243031800000E-0;
	CLM[9 ][6 ] = 	-2.2781998888800000E-06;        SLM[9 ][6 ] = -3.0715273343400000E-0;
	CLM[9 ][7 ] = 	-4.0667010079400000E-06;        SLM[9 ][7 ] = 1.1124380153300000E-07;
	CLM[9 ][8 ] = 	-1.2417922119500000E-06;        SLM[9 ][8 ] = -2.1289753637800000E-0;
	CLM[9 ][9 ] = 	-8.9729266513600000E-07;        SLM[9 ][9 ] = 2.4579732741000000E-06;
	CLM[10][0 ] = 	-9.3114073326600000E-07;        SLM[10][0 ] = 0.0000000000000000E+00;
	CLM[10][1 ] = 	8.1606529910700000E-07	;       SLM[10][1 ] = -9.8725426540599900E-0;
	CLM[10][2 ] = 	2.4116168322300000E-07	;       SLM[10][2 ] = -2.6937310575500000E-0;
	CLM[10][3 ] = 	3.9656139500900000E-07	;       SLM[10][3 ] = 7.6448204809300000E-07;
	CLM[10][4 ] = 	-3.5712895814800000E-06;        SLM[10][4 ] = 1.5451329472400000E-06;
	CLM[10][5 ] = 	7.2589515009100000E-07	;       SLM[10][5 ] = -3.6865160299300000E-0;
	CLM[10][6 ] = 	-1.9594963572900000E-07;        SLM[10][6 ] = -1.8190404104200000E-0;
	CLM[10][7 ] = 	-3.8384660735300000E-06;        SLM[10][7 ] = -8.0529023731500000E-0;
	CLM[10][8 ] = 	-3.4110179729000000E-06;        SLM[10][8 ] = 2.5825341981100000E-06;
	CLM[10][9 ] = 	-4.7857831380700000E-06;        SLM[10][9 ] = -1.2252439468000000E-0;
	CLM[10][10] = 	9.2389290163800000E-07	;       SLM[10][10] = -1.7021285740500000E-0;
	CLM[11][0 ] = 	-9.7533181673799900E-07;        SLM[11][0 ] = 0.0000000000000000E+00;
	CLM[11][1 ] = 	-1.2037996520800000E-07;        SLM[11][1 ] = 6.1732666672700000E-07;
	CLM[11][2 ] = 	7.4262261094600000E-07	;       SLM[11][2 ] = -1.9426861673300000E-0;
	CLM[11][3 ] = 	4.2572207099700000E-07	;       SLM[11][3 ] = 7.9096299217600000E-07;
	CLM[11][4 ] = 	-9.5396764344300000E-07;        SLM[11][4 ] = 2.1309711246900000E-06;
	CLM[11][5 ] = 	1.5249134929100000E-07	;       SLM[11][5 ] = 2.5614920607000000E-06;
	CLM[11][6 ] = 	4.8652146816700000E-07	;       SLM[11][6 ] = -1.3591163335500000E-0;
	CLM[11][7 ] = 	-7.1399705107200000E-08;        SLM[11][7 ] = -3.1627003132000000E-0;
	CLM[11][8 ] = 	-2.2331345384400000E-06;        SLM[11][8 ] = -4.7131427841600000E-0;
	CLM[11][9 ] = 	-2.4352600780300000E-06;        SLM[11][9 ] = 4.9042095459700000E-07;
	CLM[11][10] = 	-4.7069328544200000E-06;        SLM[11][10] = -1.4730992678800000E-0;
	CLM[11][11] = 	-2.8899820638600000E-06;        SLM[11][11] = -1.7407525423400000E-0;
	CLM[12][0 ] = 	-1.9373983442000000E-06;        SLM[12][0 ] = 0.0000000000000000E+00;
	CLM[12][1 ] = 	-5.8402813289700000E-07;        SLM[12][1 ] = 1.6008034153500000E-06;
	CLM[12][2 ] = 	-1.5597569072500000E-07;        SLM[12][2 ] = 1.5074924731800000E-06;
	CLM[12][3 ] = 	8.1762329782900000E-07	;       SLM[12][3 ] = -4.0165863227400000E-0;
	CLM[12][4 ] = 	9.2001056547500000E-07	;       SLM[12][4 ] = -5.1168403623700000E-0;
	CLM[12][5 ] = 	-1.6132915767400000E-07;        SLM[12][5 ] = 8.5271107689700000E-07;
	CLM[12][6 ] = 	8.6638269578300000E-07	;       SLM[12][6 ] = 6.9623757769000000E-07;
	CLM[12][7 ] = 	2.1777198764600000E-06	;       SLM[12][7 ] = -8.5942049780100000E-0;
	CLM[12][8 ] = 	4.6448225228700000E-07	;       SLM[12][8 ] = -1.9312668689900000E-0;
	CLM[12][9 ] = 	-1.2756997090600000E-06;        SLM[12][9 ] = 1.0992645699200000E-06;
	CLM[12][10] = 	-3.0518326090900000E-06;        SLM[12][10] = -1.4078673338100000E-0;
	CLM[12][11] = 	-8.8201859537800000E-07;        SLM[12][11] = -2.9386835973200000E-0;
	CLM[12][12] = 	3.2412110150000000E-07	;       SLM[12][12] = 1.2206627717100000E-06;
	CLM[13][0 ] = 	2.7211415614200000E-07	;       SLM[13][0 ] = 0.0000000000000000E+00;
	CLM[13][1 ] = 	1.1243746276300000E-06	;       SLM[13][1 ] = -1.0521208154900000E-0;
	CLM[13][2 ] = 	-3.5250230694700000E-06;        SLM[13][2 ] = 5.1027940437900000E-07;
	CLM[13][3 ] = 	-3.1501827210000000E-07;        SLM[13][3 ] = -1.4797236603300000E-0;
	CLM[13][4 ] = 	8.3266769752300000E-07	;       SLM[13][4 ] = -6.8924030040500000E-0;
	CLM[13][5 ] = 	-1.3375475834600000E-06;        SLM[13][5 ] = 1.3142986657500000E-06;
	CLM[13][6 ] = 	1.3263776268700000E-07	;       SLM[13][6 ] = 1.5526491985600000E-06;
	CLM[13][7 ] = 	1.3550605965400000E-07	;       SLM[13][7 ] = -9.7769142661799900E-0;
	CLM[13][8 ] = 	-3.3503367788600000E-07;        SLM[13][8 ] = -1.4851466564300000E-0;
	CLM[13][9 ] = 	-2.9075861709000000E-07;        SLM[13][9 ] = 3.8998158989700000E-07;
	CLM[13][10] = 	-6.1218634305400000E-07;        SLM[13][10] = 5.6003557139800000E-07;
	CLM[13][11] = 	-1.2584543563800000E-06;        SLM[13][11] = 4.4010125002800000E-07;
	CLM[13][12] = 	-7.4197505165200000E-07;        SLM[13][12] = -1.5983127332600000E-0;
	CLM[13][13] = 	2.4732661543000000E-06	;       SLM[13][13] = -2.6456254412300000E-0;
	CLM[14][0 ] = 	3.2407267009500000E-07	;       SLM[14][0 ] = 0.0000000000000000E+00;
	CLM[14][1 ] = 	6.6058861539300000E-07	;       SLM[14][1 ] = -6.1020801155600000E-0;
	CLM[14][2 ] = 	5.2371291417900000E-07	;       SLM[14][2 ] = 3.8935995354200000E-07;
	CLM[14][3 ] = 	6.7615559830200000E-07	;       SLM[14][3 ] = 2.6990023704100000E-08;
	CLM[14][4 ] = 	-4.0558058403400000E-07;        SLM[14][4 ] = -2.5879741455600000E-0;
	CLM[14][5 ] = 	-8.8201591999200000E-07;        SLM[14][5 ] = -1.1526840668900000E-0;
	CLM[14][6 ] = 	-5.1689352587800000E-07;        SLM[14][6 ] = 1.4938648994300000E-06;
	CLM[14][7 ] = 	-6.6980625712500000E-07;        SLM[14][7 ] = 8.7494060714700000E-07;
	CLM[14][8 ] = 	2.0564166331600000E-08	;       SLM[14][8 ] = 8.9201632075900000E-07;
	CLM[14][9 ] = 	1.7416538268600000E-07	;       SLM[14][9 ] = -1.2132802530100000E-0;
	CLM[14][10] = 	-6.6115523220000000E-07;        SLM[14][10] = 5.5582302743300000E-07;
	CLM[14][11] = 	-2.1804532191100000E-06;        SLM[14][11] = 1.7656260246100000E-06;
	CLM[14][12] = 	-1.5287123226100000E-06;        SLM[14][12] = -4.6868857445100000E-0;
	CLM[14][13] = 	-1.1618713192600000E-07;        SLM[14][13] = -9.5125185515500000E-0;
	CLM[14][14] = 	-5.9933424221500000E-07;        SLM[14][14] = 1.0854056590600000E-06;
	CLM[15][0 ] = 	-5.3000686162200000E-08;        SLM[15][0 ] = 0.0000000000000000E+00;
	CLM[15][1 ] = 	-7.7202378867700000E-07;        SLM[15][1 ] = 3.4168252171000000E-07;
	CLM[15][2 ] = 	-1.7340876923000000E-07;        SLM[15][2 ] = 7.1075318758000000E-07;
	CLM[15][3 ] = 	-1.3280247300800000E-06;        SLM[15][3 ] = -7.0722248838500000E-0;
	CLM[15][4 ] = 	-1.1228802547300000E-06;        SLM[15][4 ] = -1.2875306907900000E-0;
	CLM[15][5 ] = 	-1.5782022913400000E-07;        SLM[15][5 ] = -7.7173809815800000E-0;
	CLM[15][6 ] = 	5.0167023091200000E-08	;       SLM[15][6 ] = -3.3229754079800000E-0;
	CLM[15][7 ] = 	1.1554007281800000E-06	;       SLM[15][7 ] = 1.8522354081900000E-06;
	CLM[15][8 ] = 	1.4950305299900000E-06	;       SLM[15][8 ] = 2.2435949322600000E-06;
	CLM[15][9 ] = 	1.0206019451000000E-07	;       SLM[15][9 ] = -1.5514592889200000E-0;
	CLM[15][10] = 	-2.7337309683900000E-07;        SLM[15][10] = -5.1461126346600000E-0;
	CLM[15][11] = 	-1.4705270709300000E-06;        SLM[15][11] = -1.3478459659700000E-0;
	CLM[15][12] = 	-1.3159580444600000E-06;        SLM[15][12] = -3.3978174283300000E-0;
	CLM[15][13] = 	-3.4157247822200000E-07;        SLM[15][13] = 3.0402555126000000E-07;
	CLM[15][14] = 	6.4125297094100000E-07	;       SLM[15][14] = 5.4815182537200000E-07;
	CLM[15][15] = 	5.4846144170000000E-07	;       SLM[15][15] = 7.0101269955000000E-07;
	CLM[16][0 ] = 	4.0911715382000000E-07	;       SLM[16][0 ] = 0.0000000000000000E+00;
	CLM[16][1 ] = 	-9.7307363342400000E-08;        SLM[16][1 ] = 8.7601749769200000E-07;
	CLM[16][2 ] = 	1.6498030941500000E-06	;       SLM[16][2 ] = 3.4479238149400000E-08;
	CLM[16][3 ] = 	-1.0285437573600000E-07;        SLM[16][3 ] = 4.2790544595100000E-07;
	CLM[16][4 ] = 	4.7598862656900000E-07	;       SLM[16][4 ] = 4.7845947241100000E-07;
	CLM[16][5 ] = 	9.3278159062299900E-07	;       SLM[16][5 ] = -5.2781258215300000E-0;
	CLM[16][6 ] = 	1.0388155659000000E-06	;       SLM[16][6 ] = -1.0233912178200000E-0;
	CLM[16][7 ] = 	-3.5098186462700000E-07;        SLM[16][7 ] = -7.3295856791500000E-0;
	CLM[16][8 ] = 	-1.2096477242100000E-07;        SLM[16][8 ] = 3.0617813562200000E-08;
	CLM[16][9 ] = 	-1.0248786927200000E-06;        SLM[16][9 ] = -1.1753135514200000E-0;
	CLM[16][10] = 	2.0410689823100000E-07	;       SLM[16][10] = 5.7388327681600000E-07;
	CLM[16][11] = 	4.3535882141200000E-08	;       SLM[16][11] = 1.1426975061500000E-06;
	CLM[16][12] = 	-1.3704275367500000E-06;        SLM[16][12] = 7.9811235764900000E-07;
	CLM[16][13] = 	-7.5154554387800000E-07;        SLM[16][13] = -1.5829877730400000E-0;
	CLM[16][14] = 	-6.9855300347300000E-07;        SLM[16][14] = -3.9516079729700000E-0;
	CLM[16][15] = 	-2.7259169620200000E-07;        SLM[16][15] = -1.0559449288800000E-0;
	CLM[16][16] = 	-9.0909196696000000E-07;        SLM[16][16] = -7.8625665940600000E-0;
	CLM[17][0 ] = 	-1.0546091769100000E-06;        SLM[17][0 ] = 0.0000000000000000E+00;
	CLM[17][1 ] = 	8.0016551032300000E-07	;       SLM[17][1 ] = 8.7825661353799900E-08;
	CLM[17][2 ] = 	-1.7120079380300000E-07;        SLM[17][2 ] = -1.0446253953300000E-0;
	CLM[17][3 ] = 	-2.1710037727700000E-07;        SLM[17][3 ] = -5.3187288992500000E-0;
	CLM[17][4 ] = 	1.1602943018000000E-06	;       SLM[17][4 ] = 2.2080469942000000E-06;
	CLM[17][5 ] = 	3.9871352217100000E-07	;       SLM[17][5 ] = -8.5465603039700000E-0;
	CLM[17][6 ] = 	6.1002493671800000E-07	;       SLM[17][6 ] = -1.4950466223100000E-0;
	CLM[17][7 ] = 	-1.6253419368500000E-06;        SLM[17][7 ] = -1.1075162979800000E-0;
	CLM[17][8 ] = 	-2.1183516726600000E-07;        SLM[17][8 ] = -1.5189748226600000E-0;
	CLM[17][9 ] = 	5.2946292259700000E-07	;       SLM[17][9 ] = 1.5609313391700000E-06;
	CLM[17][10] = 	7.2077377990200000E-07	;       SLM[17][10] = 8.8589443985200000E-07;
	CLM[17][11] = 	9.7788838976000000E-07	;       SLM[17][11] = -6.3170567392300000E-0;
	CLM[17][12] = 	4.5784231476500000E-07	;       SLM[17][12] = 5.0047619173600000E-08;
	CLM[17][13] = 	1.5265800594700000E-07	;       SLM[17][13] = -3.4221087371500000E-0;
	CLM[17][14] = 	9.3900298795200000E-07	;       SLM[17][14] = 1.4314582146600000E-07;
	CLM[17][15] = 	-7.3985237069300000E-08;        SLM[17][15] = 1.4429723538600000E-08;
	CLM[17][16] = 	-2.7796585843300000E-07;        SLM[17][16] = -2.1247921472200000E-0;
	CLM[17][17] = 	-4.0269739254800000E-07;        SLM[17][17] = 1.3523272724700000E-06;
	CLM[18][0 ] = 	-3.8455607246600000E-07;        SLM[18][0 ] = 0.0000000000000000E+00;
	CLM[18][1 ] = 	1.9269854501800000E-07	;       SLM[18][1 ] = -5.7166679892800000E-0;
	CLM[18][2 ] = 	-4.1518039975900000E-07;        SLM[18][2 ] = -7.2640583236300000E-0;
	CLM[18][3 ] = 	8.7882340665900000E-07	;       SLM[18][3 ] = 5.8104580344700000E-07;
	CLM[18][4 ] = 	-8.0024935192700000E-07;        SLM[18][4 ] = 1.1468646327100000E-06;
	CLM[18][5 ] = 	-3.2461035038400000E-07;        SLM[18][5 ] = -2.8586961506700000E-0;
	CLM[18][6 ] = 	-1.7625761114700000E-06;        SLM[18][6 ] = 9.7797803613399900E-07;
	CLM[18][7 ] = 	-1.4288779594400000E-07;        SLM[18][7 ] = -8.1325466281400000E-0;
	CLM[18][8 ] = 	6.6786200541200000E-07	;       SLM[18][8 ] = -2.2709946804600000E-0;
	CLM[18][9 ] = 	5.7812417342000000E-07	;       SLM[18][9 ] = -1.0861431715100000E-0;
	CLM[18][10] = 	1.6260167810200000E-07	;       SLM[18][10] = -6.4133776131500000E-0;
	CLM[18][11] = 	1.1901907434100000E-07	;       SLM[18][11] = -1.4449906992100000E-0;
	CLM[18][12] = 	1.1622384735800000E-06	;       SLM[18][12] = 4.6206525644800000E-07;
	CLM[18][13] = 	-7.0253547292100000E-07;        SLM[18][13] = -2.5650784502000000E-0;
	CLM[18][14] = 	-1.8178766038900000E-07;        SLM[18][14] = -6.2524960235900000E-0;
	CLM[18][15] = 	-8.7226066314800000E-08;        SLM[18][15] = -8.5521865260900000E-0;
	CLM[18][16] = 	8.7247475074200000E-07	;       SLM[18][16] = -9.7515651282200000E-0;
	CLM[18][17] = 	1.0815949585800000E-06	;       SLM[18][17] = -4.3322379653900000E-0;
	CLM[18][18] = 	-1.3739572059300000E-07;        SLM[18][18] = -1.6866749489100000E-0;
	CLM[19][0 ] = 	-1.9664358018600000E-08;        SLM[19][0 ] = 0.0000000000000000E+00;
	CLM[19][1 ] = 	-4.9629281047000000E-07;        SLM[19][1 ] = 1.9175397274700000E-07;
	CLM[19][2 ] = 	3.6512861875400000E-07	;       SLM[19][2 ] = -3.6738689768500000E-0;
	CLM[19][3 ] = 	-8.2498860328000000E-07;        SLM[19][3 ] = 9.8854682993200000E-07;
	CLM[19][4 ] = 	-8.3314560665200000E-07;        SLM[19][4 ] = -1.0375323260600000E-0;
	CLM[19][5 ] = 	-3.7142673700400000E-08;        SLM[19][5 ] = 1.3247569585400000E-06;
	CLM[19][6 ] = 	-3.6798635430700000E-08;        SLM[19][6 ] = 3.3400650028200000E-07;
	CLM[19][7 ] = 	1.1124624709600000E-06	;       SLM[19][7 ] = 3.5381535904300000E-07;
	CLM[19][8 ] = 	5.1045150877600000E-07	;       SLM[19][8 ] = 5.1925269708700000E-07;
	CLM[19][9 ] = 	-1.2419290321800000E-07;        SLM[19][9 ] = 6.8045128847500000E-08;
	CLM[19][10] = 	-7.5183100379500000E-07;        SLM[19][10] = 2.7829829753500000E-07;
	CLM[19][11] = 	1.5769779037000000E-07	;       SLM[19][11] = -1.5122943002700000E-0;
	CLM[19][12] = 	1.0105320370400000E-07	;       SLM[19][12] = -2.5392185566400000E-0;
	CLM[19][13] = 	3.2367788376300000E-07	;       SLM[19][13] = 2.2410574684600000E-06;
	CLM[19][14] = 	-5.1062953275200000E-07;        SLM[19][14] = 9.1030192982700000E-07;
	CLM[19][15] = 	2.7077866927300000E-07	;       SLM[19][15] = -8.2081495393500000E-0;
	CLM[19][16] = 	-9.9388006171600000E-09;        SLM[19][16] = 5.4288744806500000E-07;
	CLM[19][17] = 	-9.2498214638700000E-07;        SLM[19][17] = -1.0615512111700000E-0;
	CLM[19][18] = 	1.2950873002600000E-06	;       SLM[19][18] = -1.8084909869500000E-0;
	CLM[19][19] = 	4.7207166631200000E-07	;       SLM[19][19] = 3.1933012838000000E-07;
	CLM[20][0 ] = 	5.2871566257700000E-07	;       SLM[20][0 ] = 0.0000000000000000E+00;
	CLM[20][1 ] = 	3.8944487915400000E-08	;       SLM[20][1 ] = -4.9246621516700000E-0;
	CLM[20][2 ] = 	5.3207813938900000E-07	;       SLM[20][2 ] = -9.7243439250500000E-0;
	CLM[20][3 ] = 	4.7956749892100000E-07	;       SLM[20][3 ] = -1.0138627390600000E-0;
	CLM[20][4 ] = 	7.9114268896500000E-07	;       SLM[20][4 ] = -5.8264224884200000E-0;
	CLM[20][5 ] = 	1.0324759496400000E-07	;       SLM[20][5 ] = -4.8023227187100000E-0;
	CLM[20][6 ] = 	-4.9677024614500000E-07;        SLM[20][6 ] = 6.1569931789700000E-07;
	CLM[20][7 ] = 	-5.9173369426500000E-07;        SLM[20][7 ] = -5.4401861062800000E-0;
	CLM[20][8 ] = 	4.3940054545300000E-07	;       SLM[20][8 ] = 7.4406236497300000E-08;
	CLM[20][9 ] = 	-8.7401555434300000E-08;        SLM[20][9 ] = 4.5618337491000000E-07;
	CLM[20][10] = 	2.3636323956700000E-07	;       SLM[20][10] = -3.5777498404300000E-0;
	CLM[20][11] = 	1.0784984132400000E-07	;       SLM[20][11] = 6.7245040866500000E-07;
	CLM[20][12] = 	4.2381529382700000E-08	;       SLM[20][12] = -9.9795427387700000E-0;
	CLM[20][13] = 	7.6496469330200000E-07	;       SLM[20][13] = 6.5100630914500000E-07;
	CLM[20][14] = 	2.5324283835900000E-07	;       SLM[20][14] = -1.1960643340200000E-0;
	CLM[20][15] = 	-1.5140371583000000E-07;        SLM[20][15] = -3.4871433386800000E-0;
	CLM[20][16] = 	8.9583332996600000E-07	;       SLM[20][16] = 5.2752501864600000E-07;
	CLM[20][17] = 	9.6258833976500000E-07	;       SLM[20][17] = -1.2470762488300000E-0;
	CLM[20][18] = 	5.3343604311800000E-07	;       SLM[20][18] = -6.4623665965800000E-0;
	CLM[20][19] = 	-2.9607880710700000E-07;        SLM[20][19] = 5.6257909241000000E-07;
	CLM[20][20] = 	2.8917140603700000E-08	;       SLM[20][20] = -3.8450589511800000E-0;
	CLM[21][0 ] = 	-9.2427816577600000E-08;        SLM[21][0 ] = 0.0000000000000000E+00;
	CLM[21][1 ] = 	-1.9435355918500000E-07;        SLM[21][1 ] = 4.9677119023500000E-07;
	CLM[21][2 ] = 	-1.4547766712600000E-06;        SLM[21][2 ] = -1.6466296127300000E-0;
	CLM[21][3 ] = 	5.4868371735400000E-07	;       SLM[21][3 ] = -8.9134759862200000E-0;
	CLM[21][4 ] = 	-5.6143191628700000E-07;        SLM[21][4 ] = 5.4221775207000000E-07;
	CLM[21][5 ] = 	1.0069353210300000E-07	;       SLM[21][5 ] = 2.3847369803200000E-07;
	CLM[21][6 ] = 	-5.8974094719200000E-08;        SLM[21][6 ] = -1.6815724179100000E-0;
	CLM[21][7 ] = 	-1.6360756261700000E-07;        SLM[21][7 ] = 2.8200222982100000E-07;
	CLM[21][8 ] = 	-7.5679519282300000E-07;        SLM[21][8 ] = -3.0592544202400000E-0;
	CLM[21][9 ] = 	-1.2195294531900000E-07;        SLM[21][9 ] = -4.6708539475500000E-0;
	CLM[21][10] = 	3.9352599180500000E-08	;       SLM[21][10] = -3.7436773235500000E-0;
	CLM[21][11] = 	-1.3248149871600000E-07;        SLM[21][11] = 1.2211232317500000E-07;
	CLM[21][12] = 	-8.4009087303600000E-08;        SLM[21][12] = 7.1893748925200000E-07;
	CLM[21][13] = 	-2.4361575926700000E-07;        SLM[21][13] = -1.0274154945900000E-0;
	CLM[21][14] = 	-2.2379965065100000E-07;        SLM[21][14] = 2.9211216475100000E-07;
	CLM[21][15] = 	-6.5515875232499900E-07;        SLM[21][15] = 4.9136697005800000E-07;
	CLM[21][16] = 	1.1491617406300000E-06	;       SLM[21][16] = 7.5983694467300000E-08;
	CLM[21][17] = 	7.1110083544700000E-07	;       SLM[21][17] = 3.6656816771800000E-07;
	CLM[21][18] = 	-2.9502651805200000E-07;        SLM[21][18] = -3.1065617283800000E-0;
	CLM[21][19] = 	2.3362849792100000E-06	;       SLM[21][19] = 4.0755645098200000E-07;
	CLM[21][20] = 	-5.2205729075100000E-07;        SLM[21][20] = 2.2828079151700000E-06;
	CLM[21][21] = 	-4.8930701366100000E-07;        SLM[21][21] = 3.7799192315700000E-07;
#endif //NONE_DATA_FILE_MODE
}

void Moon::SetGravityField(GRAVITY grv)
{
	if(grv == GrvModel) return;
	GrvModel = grv;
	std::string Name;
	switch(grv)
	{
#if __APPLE__
    case GLGM2:
        Name = DataDir + "/data/GLGM2.grv";
        break;
    case LP165P:
        Name = DataDir + "/data/LP165P.grv";
        break;
#else
	case GLGM2:
        Name = DataDir + "\\data\\GLGM2.grv";
		break;
	case LP165P:
		Name = DataDir + "\\data\\LP165P.grv";
		break;
#endif
	default:
		throw CentralBodyException("CMoon::SetEarthGravityField(): Can't find that Gravity model!");
	}
	ReadGrvFile(Name.c_str());
}

//! 获得地心J2000惯性系下的位置
vec3 Moon::GetECI(const CDateTime& t)
{
	if(EphModel==DE421EPH)
	{
		return DE421::Instance()->Moon(t);
	}
	else if(EphModel==DE405EPH)
	{
		return DE405::Instance()->Moon(t);
	}
	else if(EphModel==ANALYTICEPH)
	{
		return MoonAnalytic(t);
	}
	else
	{
		throw CentralBodyException("EphModel is not exit");
	}
}


Sun* Sun::theInstance = NULL;

Sun* Sun::Instance()
{
	if(theInstance==NULL)
		theInstance = new Sun;
	return theInstance;
}

Sun::Sun()
{
}

void Sun::SetGravityField(GRAVITY grv)
{
}

//! 获得地心J2000惯性系下的位置
vec3 Sun::GetECI(const CDateTime& t)
{
	if(EphModel==DE421EPH)
	{
		return DE421::Instance()->Sun(t);
	}
	else if(EphModel==DE405EPH)
	{
		return DE405::Instance()->Sun(t);
	}
	else if(EphModel==ANALYTICEPH)
	{
		return SunAnalytic(t);
	}
	else
	{
		throw CentralBodyException("EphModel is not exit");
	}
}

////////////////////////////////////////////
// Following program is provided by Doc. Hu

/// 大气密度参数表(美国标准大气SA76)
namespace Atmosphere{
	static double hpi[8] = {0,11000,20000,32000,47000,51000,71000,84852};
	static double tti[7] = {288.15,216.65,216.65,228.65,270.65,270.65,214.65};
	static double eli[7] = {-0.0065,0.0,0.001,0.0028,0.0,-0.0028,-0.002};
	static double pi[8] = {0.101325e+6, 0.226321e+5, 0.547488e+4, 0.868018e+3, 0.110906e+3, 0.669387e+2, 0.395641e+1, 0.363382e+0};
	static double feoc[25][5] = {
		    {85.,   -.508515e+01, -.733375e-01, -.825405e-03,  .479193e-04},
			{90.,   -.546648e+01, -.779976e-01, -.106615e-03,  .561803e-05},
			{100.,  -.625150e+01, -.784445e-01,  .619256e-04,  .168843e-04},
			{110.,  -.701287e+01, -.721407e-01,  .568454e-03,  .241761e-04},
			{120.,  -.765326e+01, -.535188e-01,  .129374e-02, -.296655e-04},
			{130.,  -.808874e+01, -.365437e-01,  .403772e-03, -.289208e-05},
			{140.,  -.841669e+01, -.293359e-01,  .317010e-03, -.442685e-05},
			{150.,  -.868227e+01, -.243238e-01,  .184205e-03, -.144722e-05},
			{160.,  -.890904e+01, -.210738e-01,  .140788e-03, -.137461e-05},
			{170.,  -.910707e+01, -.186705e-01,  .995495e-04, -.677454e-06},
			{180.,  -.928450e+01, -.168827e-01,  .792259e-04, -.593218e-06},
			{190.,  -.944600e+01, -.154761e-01,  .614293e-04, -.381119e-06},
			{200.,  -.959500e+01, -.143619e-01,  .499958e-04, -.249568e-06},
			{220.,  -.986423e+01, -.126615e-01,  .350217e-04, -.154281e-06},
			{240.,  -.101047e+02, -.114458e-01,  .257648e-04, -.925137e-07},
			{260.,  -.103240e+02, -.105262e-01,  .202140e-04, -.774691e-07},
			{280.,  -.105271e+02, -.981064e-02,  .155659e-04, -.650883e-07},
			{300.,  -.107176e+02, -.926611e-02,  .116606e-04, -.249222e-07},
			{400.,  -.115525e+02, -.768166e-02,  .418393e-05, -.388723e-08},
			{500.,  -.122827e+02, -.696149e-02,  .301776e-05,  .447753e-08},
			{600.,  -.129442e+02, -.622361e-02,  .436102e-05,  .998741e-08},
			{700.,  -.135130e+02, -.505179e-02,  .735724e-05, -.124098e-10},
			{800.,  -.139446e+02, -.358071e-02,  .735352e-05, -.104955e-07},
			{900.,  -.142397e+02, -.242487e-02,  .420487e-05, -.833682e-08},
			{1001., -.000000e+00, -.000000e+00,  .000000e+00, -.000000e+00}};
}

/*!
85km以下大气密度\n
输入: 高度h(m)\n
输出: 大气密度(kg/m^3)
一般使用函数SA76()调用
*/
double SA76_LOW(double h)
{
	using namespace Atmosphere;
	double g0=9.80665;
	double rr=287.053;
	double r0=6356766.;
	double hp,dhp,tt,a,b,p;
	int k,j=7;

	hp=h/(r0+h)*r0;
	for(k=0;k<=6;k++)
	{
		if(hpi[k]<=hp && hp<hpi[k+1]) j=k;
	}
	dhp=hp-hpi[j];
	tt=tti[j]+eli[j]*dhp;
	if(eli[j]!=0)
	{
		a=1+dhp*eli[j]/tti[j];
		b=-g0/(rr*eli[j]);
		p=pi[j]*pow(a,b);
	}
	else
	{
		a=-g0*dhp/(rr*tti[j]);
		p=pi[j]*exp(a);
	}
	return p/(rr*tt);
}
/*!
85km以上大气密度\n
输入: 高度h(m)\n
输出: 大气密度(kg/m^3)
一般使用函数SA76()调用
*/
double SA76_HIGH(double h)
{
	using namespace Atmosphere;
	double hk,dif,diff,difff,dsr;
	int k,n=24;

	hk=h*.001;
	for(k=0;k<=23;k++)
	{
		if(hk>=feoc[k][0] && hk<feoc[k+1][0]) n=k;
	}
	if(fabs(hk-1001.)<1e-09) n=24;
	dif=hk-feoc[n][0];
	diff=dif*dif;
	difff=diff*dif;
	dsr=feoc[n][1]+feoc[n][2]*dif+feoc[n][3]*diff+feoc[n][4]*difff;
	return exp(log(10.)*dsr);
}
/*!
美国1976标准大气模型\n
根据高度，高度小于85km时调用SA76_LOW()，高度大于85km时调用SA76_HIGH()
输入: 高度h(km)\n
输出: 大气密度(kg/m^3)
*/
double SA76(double h)
{
	if( h > 1000.0 ) return 0; // 1000km以上的大气密度为0
	if(h<85.0)
	{
		if(h<0) h=0.1;
		return SA76_LOW(h*1000);
	}
	else
		return SA76_HIGH(h*1000);
}
